<!DOCTYPE html>
<head>
  <title>Time in the market</title>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel="stylesheet"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js"></script>
  <style>
    body{
      font-family: 'Open Sans';
    }
    #header{
      margin: auto;
      margin-left: 7px;
      margin-bottom: 75px;
    }
    #controls{
      display: flex;
    }
    #stockChart{
      flex-wrap: wrap;
    }
    .control-button{
      border-radius: 10px;
      border: 0;
      outline: none;
      font-family: 'Open Sans';
      margin: 0px 10px 30px 10px;
      color: white;
      background-color: #b0b0b0;
      padding: 10px;
      cursor: pointer;
      height: 40px;
      box-shadow: 0 3px #999;
    }
    .control-button:active:hover{
      transform: translateY(2px);
      transition: 0s;
    }
    .control-button:hover{
      background-color: #808080;
      transition: 0.1s;
    }
    .contol-slider{
      height: 10px;
      align-self: top;
    }
  </style>
</head>
<html>
  <body>
    <h1 id=header>Why shouldn't I sell now?</h1>
    <div id=controls>
      <button class='control-button' onclick='start()'/>Start</button>
      <button class='control-button' onclick='end()'/>End</button>
      <button class='control-button' onclick='buy()'/>Buy</button>
      <button class='control-button' onclick='sell()'>Sell</button>
      <p id=investmentValueLabel>Investment value: 10000</p>
    </div>
    <canvas id='stockChart' width='1200px' height='400px'/>
    <script>
      function add_new_market_value(){
        var prevValue = dailyValues[dailyValues.length-1];
        var marketGainOrLoss = (Math.random()*(0.01));
        var diceRoll = Math.random();
        if (diceRoll > 0.51){ //biased 2% towards increasing in value to try and replicate real market performance
          console.log(prevValue*(1-marketGainOrLoss))
          var marketChange = 1-marketGainOrLoss;
        }
        else{
          var marketChange = 1+marketGainOrLoss;
        }
        dailyValues.push(Math.floor(prevValue*marketChange));
        document.getElementById('investmentValueLabel').innerHTML = 'Investment value: '+prevValue;
        if (playerInMarket == true){
          investmentValue = investmentValue*marketChange;
        }
      }
      function start(){
        var gameRunning = true;
      }
      function end(){
        gameRunning = false;
      }
      function buy(){
        playerInMarket = true;
      }
      function sell(){
        playerInMarket = false;
      }
      var daysElapsed = 1;
      var dailyValues = [10000];
      var investmentValue = 10000;
      var gameRunning = false;
      var playerInMarket = false;
      var canvas = document.getElementById('stockChart');
      var data = {
                 labels: [1,2,3,4,5],
                 datasets: [{
                   data: dailyValues,
                   fill: false,
                   backgroundColor: 'rgba(208, 73, 73, 1)',
                   borderColor: 'rgba(208, 73, 73, 1)'
                   }]
                 };
      var options = {
                      legend: {display: false},
                      elements: {
                        line: {tension: 0},
                        point: {radius: 0}
                      }, //removes bezier smoothing
                      responsive: true,
                      scales: {
                        xAxes: [{
                          display: true,
                          scaleLabel: {
                            display: true,
                            labelString: 'Days elapsed'
                          }
                        }],
                        yAxes: [{
                          display: true,
                          scaleLabel: {
                            display: true,
                            labelString: 'Value'
                          }
                        }]
                      }
                    };
      var chart = new Chart(canvas,{
        type: 'line',
        data: data,
        options: options
      });
      setTimeout(function(){
        if (gameRunning){
          daysElapsed++;
          add_new_market_value();
          chart.data.labels.push(daysElapsed);
          chart.update();
        }
      }, 200)
    </script>
  </body>
</html>
